import{n as g,M as I,T as w,S as _}from"./FaceMatcher.94dbf9cd.js";import{d as k}from"./drawDetections.cb76136a.js";import{b as S}from"./bufferToImage.0eb741dc.js";import{d as C,m as M,r as D}from"./resizeResults.b26e0a3c.js";import{_ as z}from"./index.26d86ee2.js";import{d as U,y as L,r as c,x as T,E as a,f as t,w as o,F as R,o as E,G as V,H as $,I as h}from"./vendor.43a23b66.js";const P=U({name:"bbt-face-matching",data(){return{showModal:!0,showView:!1,showLoading:!1,minConfidence:.5,scoreThreshold:.5,inputSize:512,imgUrl:"",fileList:[],selectvalue:"bbt1.jpg",facevalue:"ssdMobilenetv1",drawImg:"/images/bbt1.jpg",defaultImgs:[{label:"bbt1.jpg",value:"bbt1.jpg"},{label:"bbt2.jpg",value:"bbt2.jpg"},{label:"bbt3.jpg",value:"bbt3.jpg"},{label:"bbt4.jpg",value:"bbt4.jpg"},{label:"bbt5.jpg",value:"bbt5.jpg"}],faces:[{label:"SSD Mobilenet V1",value:"ssdMobilenetv1"},{label:"Tiny Face Detector",value:"tinyFaceDetector"}],options:null}},watch:{selectvalue(e){this.drawImg=`public/images/${e}`,this.updateResults()},facevalue(e){this.fnInit(),this.updateResults()}},mounted(){this.$nextTick(()=>{this.fnInit().then(()=>this.updateResults())}),this.$message=L()},methods:{async fnInit(){switch(this.showLoading=!0,await g[this.facevalue].loadFromUri("/models"),this.facevalue){case"ssdMobilenetv1":this.options=new _({minConfidence:.5});break;case"tinyFaceDetector":this.options=new w({inputSize:512,scoreThreshold:.5});break;case"mtcnn":this.options=new I({minFaceSize:20,scaleFactor:.709});break}this.showLoading=!1},handleChange({event:e,file:s,fileList:d}){this.drawImg=URL.createObjectURL(s.file),this.updateResults(),this.fileList=d},viewSample(){this.showView=!0},async clickConfirm(){if(this.imgUrl){let e=await this.requestExternalImage(this.imgUrl);this.drawImg=e.src,this.updateResults()}},getCurrentFaceDetectionNet(){if(this.facevalue==="ssdMobilenetv1")return g.ssdMobilenetv1;if(this.facevalue==="tinyFaceDetector")return g.tinyFaceDetector},isFaceDetectionModelLoaded(){return!!this.getCurrentFaceDetectionNet().params},getFaceDetectorOptions(){return this.facevalue==="ssdMobilenetv1"?new _({minConfidence:this.minConfidence}):new w({inputSize:this.inputSize,scoreThreshold:this.scoreThreshold})},async requestExternalImage(e){let s=await fetch(e);try{let d=await s.blob();return await S(d)}catch{throw new Error("failed to load image from url: "+e)}},async updateResults(){if(!this.isFaceDetectionModelLoaded())return;const e=document.getElementById("inputImg"),s=this.getFaceDetectorOptions(),d=await C(e,s),r=document.getElementById("overlay");r.width=e.width,r.height=e.height,M(r,e);let p=D(d,e);p.length?k(r,p):this.$message.error("\u8FD9\u53EF\u80FD\u4E0D\u662F\u4E2A\u4EBA\uFF01")}}}),n=e=>(V("data-v-16bc09f8"),e=e(),$(),e),O={style:{position:"relative"},class:"margin"},B={style:{width:"300px","margin-right":"10px"}},N=n(()=>a("h4",null,"\u56FE\u7247\u8F93\u5165",-1)),q=n(()=>a("label",{for:""},"\u9009\u62E9\u4E00\u4E2A\u7167\u7247\u5427\uFF1A",-1)),A=h("\u6216\u8005"),G=n(()=>a("label",{for:""},"\u8F93\u5165\u4E00\u4E2A\u56FE\u7247\u94FE\u63A5\uFF1A",-1)),H=h("\u786E\u5B9A"),J=h("\u6216\u8005"),K=n(()=>a("label",{for:""},"\u4ECE\u672C\u5730\u9009\u4E00\u5F20\u56FE\u7247\uFF1A",-1)),Q=h("\u9009\u62E9\u6587\u4EF6"),W=n(()=>a("h4",null,"\u9009\u62E9\u4EBA\u8138\u68C0\u6D4B\u5668",-1)),X=n(()=>a("h4",null,"\u6837\u672C\u5E93",-1)),Y=h("\u67E5\u770B\u6837\u672C\u5E93"),Z={style:{position:"relative"}},x=["src"],ee=n(()=>a("canvas",{id:"overlay"},null,-1)),te=n(()=>a("div",{class:"loader"}," \u52A0\u8F7D\u4E2D... ",-1)),se=n(()=>a("h4",null,"\u5C0F\u5305",-1)),ae=n(()=>a("h4",null,"\u6253\u5305",-1));function oe(e,s,d,r,p,ne){const f=c("n-select"),u=c("n-divider"),v=c("n-input"),m=c("n-button"),j=c("n-upload"),y=c("n-space"),b=c("n-modal"),i=c("n-image"),F=c("n-image-group");return E(),T(R,null,[a("div",O,[t(y,null,{default:o(()=>[a("div",B,[N,q,t(f,{value:e.selectvalue,"onUpdate:value":s[0]||(s[0]=l=>e.selectvalue=l),options:e.defaultImgs},null,8,["value","options"]),t(u,{"title-placement":"left"},{default:o(()=>[A]),_:1}),G,t(v,{value:e.imgUrl,"onUpdate:value":s[1]||(s[1]=l=>e.imgUrl=l),type:"text",placeholder:"\u56FE\u7247\u94FE\u63A5"},null,8,["value"]),t(m,{onClick:e.clickConfirm},{default:o(()=>[H]),_:1},8,["onClick"]),t(u,{"title-placement":"left"},{default:o(()=>[J]),_:1}),K,t(j,{onChange:e.handleChange,"default-upload":!1,ref:"upload"},{default:o(()=>[t(m,null,{default:o(()=>[Q]),_:1})]),_:1},8,["onChange"]),t(u,{"title-placement":"left"}),W,t(f,{value:e.facevalue,"onUpdate:value":s[2]||(s[2]=l=>e.facevalue=l),options:e.faces},null,8,["value","options"]),t(u,{"title-placement":"left"}),X,t(m,{onClick:e.viewSample},{default:o(()=>[Y]),_:1},8,["onClick"])]),a("div",Z,[a("img",{id:"inputImg",style:{width:"100%",border:"0"},src:e.drawImg},null,8,x),ee])]),_:1})]),t(b,{show:e.showLoading,"onUpdate:show":s[3]||(s[3]=l=>e.showLoading=l)},{default:o(()=>[te]),_:1},8,["show"]),t(b,{class:"custom-card",show:e.showView,"onUpdate:show":s[4]||(s[4]=l=>e.showView=l),preset:"card",style:{width:"800px"},title:"\u6837\u672C\u5E93",size:"huge",bordered:!1},{default:o(()=>[t(F,null,{default:o(()=>[a("div",null,[se,t(i,{width:"100",height:"100",src:"public/images/bbt1.jpg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}),t(i,{width:"100",height:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"})]),a("div",null,[ae,t(i,{width:"100",src:"https://07akioni.oss-cn-beijing.aliyuncs.com/07akioni.jpeg"}),t(i,{width:"100",src:"https://gw.alipayobjects.com/zos/antfincdn/aPkFc8Sj7n/method-draw-image.svg"})])]),_:1})]),_:1},8,["show"])],64)}var ue=z(P,[["render",oe],["__scopeId","data-v-16bc09f8"]]);export{ue as default};
